name: anivel-buildpack
type: web
env:
  APP_NAME: "AniVel"
  APP_ENV: production
  APP_DEBUG: false
  APP_KEY: "base64:xBfe/FMAhapeXsCmtSV2a19A3q78b21CMOPU6Gro89Y="
  APP_URL: "https://${{ app.name }}.koyeb.app"
  LOG_CHANNEL: stderr
  LOG_LEVEL: debug
  DB_CONNECTION: sqlite
  DB_DATABASE: /app/database/database.sqlite
  SESSION_DRIVER: database
  CACHE_STORE: database
  QUEUE_CONNECTION: database
  FILESYSTEM_DISK: local
  VITE_APP_NAME: "AniVel"
  PHP_VERSION: "8.2"
build:
  type: buildpack
  buildpack: heroku/php
  run:
    - composer install --no-dev --optimize-autoloader --no-interaction --no-scripts
    - npm ci --only=production
    - npm run build
    - mkdir -p database storage/framework/cache storage/framework/sessions storage/framework/views bootstrap/cache
    - touch database/database.sqlite
    - chmod -R 775 storage bootstrap/cache database
    - php artisan config:cache
    - php artisan route:cache
    - php artisan view:cache
    - php artisan migrate --force
run:
  cmd: php artisan serve --host=0.0.0.0 --port=$PORT
